### Microsoft Fabric Trivia Challenge - API Testing
### Base URL for local development
@baseUrl = http://localhost:5109
@apiVersion = 1.0

### Variables (will be set from responses)
@userId = 
@sessionId = 
@questionId = 

###############################################################################
# QUESTION POOLS MANAGEMENT
###############################################################################

### Create the "default" pool (required for default game behavior)
# @name createDefaultPool
POST {{baseUrl}}/api/v{{apiVersion}}/pools
Content-Type: application/json

{
  "id": "default",
  "name": "Default",
  "iconPath": "/pools/default.svg",
  "description": "Default question pool for Microsoft Fabric Trivia Challenge",
  "isActive": true,
  "displayOrder": 0
}

### Create a "fabric" event pool
# @name createFabricPool
POST {{baseUrl}}/api/v{{apiVersion}}/pools
Content-Type: application/json

{
  "id": "fabric",
  "name": "Fabric",
  "iconPath": "/pools/fabric.png",
  "description": "Ready to Unify your data?",
  "isActive": true,
  "displayOrder": 1
}


### Get all active question pools
GET {{baseUrl}}/api/v{{apiVersion}}/pools

### Get a specific pool by ID
GET {{baseUrl}}/api/v{{apiVersion}}/pools/default


###############################################################################
# 0. QUESTION UPLOAD (CSV FORMAT DOCUMENTATION)
###############################################################################

# CSV Format for Questions Upload
# ================================
#
# The CSV file must include the following columns (header row required):
#
# Column Name         | Type    | Required | Description
# --------------------|---------|----------|------------------------------------------
# Category            | string  | Yes      | Question category (e.g., "Basics", "Advanced")
# Question            | string  | Yes      | The question text
# Answer1             | string  | Yes      | First answer option
# Answer2             | string  | Yes      | Second answer option
# Answer3             | string  | Yes      | Third answer option
# Answer4             | string  | Yes      | Fourth answer option
# CorrectAnswerKey    | int     | Yes      | Index of correct answer (0-3: 0=Answer1, 1=Answer2, 2=Answer3, 3=Answer4)
# Metadata            | string  | No       | Optional metadata (e.g., '{"difficulty":"easy"}' or 'difficulty:easy')
# Pools               | string  | No       | Comma-separated pool slugs (e.g., "default,ignite-2026"). Defaults to "default" if empty.
#
# EXAMPLE CSV CONTENT:
# --------------------
# Category,Question,Answer1,Answer2,Answer3,Answer4,CorrectAnswerKey,Metadata,Pools
# Basics,What is Microsoft Fabric?,A cloud platform,A physical material,A design tool,A database,0,difficulty:easy,default
# Data Engineering,What is a Lakehouse?,Unified analytics,A storage container,A query engine,A visualization tool,0,difficulty:medium,"default,ignite-2026"
# Advanced,What protocol does Fabric use for real-time?,Event Streams,HTTP,FTP,SMTP,0,difficulty:hard,ignite-2026
#
# VALIDATION RULES:
# -----------------
# ✓ All fields except Metadata are required
# ✓ Exactly 4 answers must be provided (Answer1, Answer2, Answer3, Answer4)
# ✓ CorrectAnswerKey must be between 0 and 3
# ✓ File must have .csv extension
# ✓ File must include header row
# ✓ CSV must be properly formatted (quoted fields if containing commas)
#
# SAMPLE CSV FILE (save as questions.csv):
# -----------------------------------------
# Category,Question,Answer1,Answer2,Answer3,Answer4,CorrectAnswerKey,Metadata
# "Fabric Basics","What is Microsoft Fabric?","A unified analytics platform","A cloud storage service","A database tool","A reporting solution",0,"difficulty:easy"
# "Data Integration","What is a Data Pipeline in Fabric?","Orchestrated data workflow","A storage location","A query interface","A security feature",0,"difficulty:medium"
# "Real-time Analytics","What is KQL used for?","Querying log and telemetry data","Creating dashboards","Managing permissions","Scheduling jobs",0,"difficulty:easy"
#
# Upload endpoint: POST /api/v1.0/questions/upload
# Content-Type: multipart/form-data
# Form field name: "file"

### Upload questions from CSV file
# NOTE: This is a multipart/form-data request
# In VS Code REST Client: You need to manually test this with a tool like Postman or curl
# 
# Example using curl:
# curl -X POST http://localhost:5109/api/v1.0/questions/upload \
#   -F "file=@questions.csv"
#

### Upload Fabric questions (pool: fabric)
POST {{baseUrl}}/api/v{{apiVersion}}/questions/upload
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="questions.csv"
Content-Type: text/csv

Category,Question,Answer1,Answer2,Answer3,Answer4,CorrectAnswerKey,Metadata,Pools
Fabric Fundamentals,What is Microsoft Fabric?,**A unified analytics platform for data collaboration and AI-powered insights**,Answer2,A database management system with integrated business intelligence features,A comprehensive data warehousing platform with built-in visualization tools,0,learnmodule:learn-pr/wwl/introduction-end-analytics-use-microsoft-fabric/includes/3-data-team.md,fabric
Fabric Fundamentals,Who can enable Microsoft Fabric for an organization?,Power BI service administrators only,Any user in the organization,"**Fabric, Power Platform, or Microsoft 365 administrators**",System administrators or IT support professionals,2,learnmodule:learn-pr/wwl/introduction-end-analytics-use-microsoft-fabric/includes/4-use-fabric.md,fabric
Fabric Fundamentals,What are workspaces used for in Microsoft Fabric?,Storage containers for archived data and backup systems,Personal user folders for individual data projects,Network security zones for access control management,**Collaborative environments for creating and managing analytics items**,3,learnmodule:learn-pr/wwl/introduction-end-analytics-use-microsoft-fabric/includes/4-use-fabric.md,fabric
Fabric Fundamentals,What does the OneLake data hub help users do?,Manage user permissions and access controls across workspaces,Create automated backup copies of critical data,**Find and access various data sources within the organization**,Monitor system performance metrics and usage statistics,2,learnmodule:learn-pr/wwl/introduction-end-analytics-use-microsoft-fabric/includes/4-use-fabric.md,fabric
Fabric Fundamentals,What role do analytics engineers play in Microsoft Fabric?,They manage network infrastructure and system configurations,They provide customer support and user training services,They handle financial planning and budget management,**They bridge data engineering and analysis by ensuring data quality**,3,learnmodule:learn-pr/wwl/introduction-end-analytics-use-microsoft-fabric/includes/3-data-team.md,fabric
Fabric Fundamentals,What are some services included in Microsoft Fabric?,Storage and network infrastructure management,Disaster recovery and business continuity,"**Data integration, data engineering, and real-time intelligence**","Chatbot creation, management, and distribution",2,learnmodule:learn-pr/wwl/introduction-end-analytics-use-microsoft-fabric/includes/1-introduction.md,fabric
Fabric Fundamentals,How does Microsoft Fabric streamline data analytics?,By providing separate specialized tools for each analytics task,By requiring multiple vendor licenses for comprehensive coverage,**By unifying analytics and business intelligence services in one platform**,By focusing exclusively on data storage and retrieval operations,2,learnmodule:learn-pr/wwl/introduction-end-analytics-use-microsoft-fabric/includes/2-explore-analytics-fabric.md,fabric
Fabric Fundamentals,What is OneLake in Microsoft Fabric?,A traditional relational database with standard SQL capabilities,**A lake-centric architecture providing a unified data collaboration environment**,A backup storage system for enterprise data archival,A user interface component for data visualization,1,learnmodule:learn-pr/wwl/introduction-end-analytics-use-microsoft-fabric/includes/2-explore-analytics-fabric.md,fabric
Fabric Fundamentals,How does OneLake help save time for data professionals?,By automating all data analysis tasks and report generation,By providing pre-built reports and dashboard templates,By automatically generating advanced analytics models without configuration,**By eliminating the need to move and copy data between systems**,3,learnmodule:learn-pr/wwl/introduction-end-analytics-use-microsoft-fabric/includes/2-explore-analytics-fabric.md,fabric
Fabric Fundamentals,How does Fabric ensure data security and governance?,Through individual user passwords and basic authentication processes,By encrypting only sensitive data while leaving others unprotected,Through manual approval processes for all data access requests,**By centralizing governance and simplifying access management**,3,learnmodule:learn-pr/wwl/introduction-end-analytics-use-microsoft-fabric/includes/2-explore-analytics-fabric.md,fabric
------WebKitFormBoundary7MA4YWxkTrZu0gW--

### Upload SQL Server & Azure SQL questions (pool: sql)
POST {{baseUrl}}/api/v{{apiVersion}}/questions/upload
Content-Type: multipart/form-data; boundary=----WebKitFormBoundarySQLQuestions

------WebKitFormBoundarySQLQuestions
Content-Disposition: form-data; name="file"; filename="sql-questions.csv"
Content-Type: text/csv

Category,Question,Answer1,Answer2,Answer3,Answer4,CorrectAnswerKey,Metadata,Pools
SQL Server,What is the default port number for SQL Server?,1521,**1433**,3306,5432,1,sql-server-fundamentals,sql
SQL Server,"What does the COALESCE function do in T-SQL?",Converts a value to a different data type,Concatenates two or more strings together,**Returns the first non-NULL expression among its arguments**,Rounds a numeric value to the nearest integer,2,t-sql-functions,sql
Azure SQL,"What is Azure SQL Database?",An on-premises SQL Server installation managed by Microsoft,A NoSQL document database hosted on Azure,A virtual machine running SQL Server on Azure,**A fully managed relational database service built on SQL Server engine**,3,azure-sql-overview,sql
SQL Server,"Which T-SQL statement is used to handle errors in stored procedures?",IF...ELSE,CASE...WHEN,WHILE...BREAK,**TRY...CATCH**,3,t-sql-error-handling,sql
Azure SQL,"What is the purpose of Azure SQL Managed Instance?",**To provide near 100% compatibility with on-premises SQL Server for easy migration**,To run SQL queries on unstructured data in Azure Blob Storage,To provide a free tier of Azure SQL Database for testing,To manage multiple Azure SQL Databases from a single dashboard,0,azure-sql-managed-instance,sql
SQL Server,"What type of index organizes data rows in the table based on key values?",Non-clustered index,Full-text index,Columnstore index,**Clustered index**,3,sql-server-indexing,sql
Azure SQL,"Which purchasing model in Azure SQL Database lets you choose vCores and storage independently?",DTU-based purchasing model,Serverless compute tier,**vCore-based purchasing model**,Hyperscale service tier,2,azure-sql-purchasing-models,sql
SQL Server,"What does the MERGE statement do in T-SQL?",Combines two result sets into one using UNION rules,"**Performs INSERT, UPDATE, or DELETE operations in a single statement based on source data**",Merges two databases into a single database,Joins two tables permanently into a new table,1,t-sql-merge,sql
Azure SQL,"What is the purpose of Active Geo-Replication in Azure SQL Database?",To replicate data to on-premises SQL Server instances,To synchronize schema changes across development environments,To create local backups of your database,**To create readable secondary databases in different Azure regions for disaster recovery**,3,azure-sql-geo-replication,sql
SQL Server,"What is a Common Table Expression (CTE) in T-SQL?",A permanent view stored in the database for reuse,A system table that stores query execution plans,"**A temporary named result set defined within a SELECT, INSERT, UPDATE, or DELETE statement**",A special index type for improving recursive query performance,2,t-sql-cte,sql
------WebKitFormBoundarySQLQuestions--

###############################################################################
# 1. USER REGISTRATION
###############################################################################

### Register a new user (or get existing)
# @name registerUser
POST {{baseUrl}}/api/v{{apiVersion}}/users/register
Content-Type: application/json

{
  "email": "test.user@microsoft.com",
  "name": "Test User",
  "phoneNumber": "+1-555-0100"
}

### Extract userId from registration response
@userId = {{registerUser.response.body.$.data.userId}}

###############################################################################
# 2. SESSION MANAGEMENT
###############################################################################

### Start a new game session (using default pool)
# @name startSession
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/start
Content-Type: application/json

{
  "userId": "{{userId}}"
}

### Start a session with a specific pool (e.g., Ignite 2026)
# @name startSessionWithPool
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/start
Content-Type: application/json

{
  "userId": "{{userId}}",
  "poolId": "ignite-2026"
}

### Extract sessionId from session response
@sessionId = {{startSession.response.body.$.data.sessionId}}

###############################################################################
# 3. QUESTION RETRIEVAL
###############################################################################

### Get all questions for the session
# @name getQuestions
GET {{baseUrl}}/api/v{{apiVersion}}/sessions/{{sessionId}}/questions

### Extract first question ID (for testing answer submission)
@questionId = {{getQuestions.response.body.$.data.questions[0].questionId}}

###############################################################################
# 4. ANSWER SUBMISSION
###############################################################################

### Submit a CORRECT answer (adjust answerIndex based on correctAnswerIndex from questions)
# @name submitCorrectAnswer
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/{{sessionId}}/answers
Content-Type: application/json

{
  "questionId": "{{questionId}}",
  "answerIndex": 0,
  "timeElapsed": 15.5,
  "isCorrect": true
}

### Submit a WRONG answer
# @name submitWrongAnswer
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/{{sessionId}}/answers
Content-Type: application/json

{
  "questionId": "{{questionId}}",
  "answerIndex": 2,
  "timeElapsed": 45.8,
  "isCorrect": false
}

###############################################################################
# 5. SESSION FINALIZATION
###############################################################################

### End the game session
# @name endSession
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/{{sessionId}}/end
Content-Type: application/json

{
  "questionsAnswered": 25,
  "correctAnswers": 20,
  "streaksCompleted": 4,
  "finalTimeRemaining": 10
}

###############################################################################
# FULL WORKFLOW TEST (Use this to test complete flow with hardcoded values)
###############################################################################

### 1. Register user with hardcoded email
# @name workflowUser
POST {{baseUrl}}/api/v{{apiVersion}}/users/register
Content-Type: application/json

{
  "email": "workflow.test@microsoft.com",
  "name": "Workflow Test User",
  "phoneNumber": "+1-555-0200"
}

###

### 2. Start session with the registered user
# @name workflowSession
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/start
Content-Type: application/json

{
  "userId": "{{workflowUser.response.body.$.data.userId}}"
}

###

### 3. Get questions for the session
GET {{baseUrl}}/api/v{{apiVersion}}/sessions/{{workflowSession.response.body.$.data.sessionId}}/questions

###

### 4. Submit first answer (you'll need to adjust questionId and answerIndex based on response)
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/{{workflowSession.response.body.$.data.sessionId}}/answers
Content-Type: application/json

{
  "questionId": "replace-with-actual-question-id",
  "answerIndex": 0,
  "timeElapsed": 10.5,
  "isCorrect": true
}

###

### 5. End the session
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/{{workflowSession.response.body.$.data.sessionId}}/end
Content-Type: application/json

{
  "questionsAnswered": 1,
  "correctAnswers": 1,
  "streaksCompleted": 0,
  "finalTimeRemaining": 55
}

###############################################################################
# MANUAL TEST (Copy and paste these, replacing placeholders manually)
###############################################################################

### Register user (manual)
POST {{baseUrl}}/api/v{{apiVersion}}/users/register
Content-Type: application/json

{
  "email": "manual.test@microsoft.com",
  "name": "Manual Test User",
  "phoneNumber": "+1-555-0300"
}

###

### Start session (replace USER_ID_HERE with actual userId from registration)
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/start
Content-Type: application/json

{
  "userId": "USER_ID_HERE"
}

###

### Get questions (replace SESSION_ID_HERE with actual sessionId)
GET {{baseUrl}}/api/v{{apiVersion}}/sessions/SESSION_ID_HERE/questions

###

### Submit answer (replace SESSION_ID_HERE and QUESTION_ID_HERE)
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/SESSION_ID_HERE/answers
Content-Type: application/json

{
  "questionId": "QUESTION_ID_HERE",
  "answerIndex": 0,
  "timeElapsed": 15.5,
  "isCorrect": true
}

###

### End session (replace SESSION_ID_HERE)
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/SESSION_ID_HERE/end
Content-Type: application/json

{
  "questionsAnswered": 5,
  "correctAnswers": 4,
  "streaksCompleted": 0,
  "finalTimeRemaining": 30
}

###############################################################################
# ERROR CASES & EDGE CASES
###############################################################################

### Try to start session with non-existent user (should fail validation)
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/start
Content-Type: application/json

{
  "userId": "00000000-0000-0000-0000-000000000000"
}

###

### Try to get questions for non-existent session
GET {{baseUrl}}/api/v{{apiVersion}}/sessions/non-existent-session-id/questions

###

### Try to submit answer for non-existent session
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/non-existent-session-id/answers
Content-Type: application/json

{
  "questionId": "some-question-id",
  "answerIndex": 0,
  "timeElapsed": 15.5,
  "isCorrect": true
}

###

### Try to end non-existent session
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/non-existent-session-id/end
Content-Type: application/json

{
  "questionsAnswered": 1,
  "correctAnswers": 1,
  "streaksCompleted": 0,
  "finalTimeRemaining": 50
}

###

### Try to submit answer with invalid answerIndex (out of range)
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/{{sessionId}}/answers
Content-Type: application/json

{
  "questionId": "{{questionId}}",
  "answerIndex": 10,
  "timeElapsed": 15.5,
  "isCorrect": false
}

###

### Try to submit answer with negative time elapsed
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/{{sessionId}}/answers
Content-Type: application/json

{
  "questionId": "{{questionId}}",
  "answerIndex": 0,
  "timeElapsed": -5.0,
  "isCorrect": true
}

###############################################################################
# POINT CALCULATION TESTS
###############################################################################

### Test easy question scoring (base 10 points)
# Time elapsed: 10s out of 120s max = 91.67% time remaining
# Expected: 10 * (1 + 0.9167) ≈ 19 points
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/{{sessionId}}/answers
Content-Type: application/json

{
  "questionId": "{{questionId}}",
  "answerIndex": 0,
  "timeElapsed": 10.0,
  "isCorrect": true
}

###

### Test medium question scoring (base 15 points)
# Time elapsed: 60s out of 120s max = 50% time remaining
# Expected: 15 * (1 + 0.5) = 22.5 ≈ 23 points
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/{{sessionId}}/answers
Content-Type: application/json

{
  "questionId": "{{questionId}}",
  "answerIndex": 0,
  "timeElapsed": 60.0,
  "isCorrect": true
}

###

### Test hard question scoring (base 20 points)
# Time elapsed: 5s out of 120s max = 95.83% time remaining
# Expected: 20 * (1 + 0.9583) ≈ 39 points
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/{{sessionId}}/answers
Content-Type: application/json

{
  "questionId": "{{questionId}}",
  "answerIndex": 0,
  "timeElapsed": 5.0,
  "isCorrect": true
}

###

### Test late answer (minimal time bonus)
# Time elapsed: 115s out of 120s max = 4.17% time remaining
# Expected: base * (1 + 0.0417) ≈ base * 1.04
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/{{sessionId}}/answers
Content-Type: application/json

{
  "questionId": "{{questionId}}",
  "answerIndex": 0,
  "timeElapsed": 115.0,
  "isCorrect": true
}

###

### Test wrong answer (0 points expected)
POST {{baseUrl}}/api/v{{apiVersion}}/sessions/{{sessionId}}/answers
Content-Type: application/json

{
  "questionId": "{{questionId}}",
  "answerIndex": 1,
  "timeElapsed": 10.0,
  "isCorrect": false
}
